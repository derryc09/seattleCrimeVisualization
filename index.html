<html class="gr__duspviz_mit_edu"><head>
    <title>A D3 map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

    <script src="gn-seattle.geojson"></script>
    <script src="seattleCrimeData.geojson"></script>    
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script> 
    <script src="https://d3js.org/topojson.v1.min.js"></script>

</head>

<!--Silder for the filter-->
<div id="sliderContainer">
    Filter by year<br>
    <input id="timeslide" type="range" min="0" max="6" value="0" step="1"/><br>
    <span id="range">2017</span><br>
    <button id="start">Start</button>
    <button id="stop">Stop</button>    
    <!--<button id="reset">Reset</button>-->
</div>


<body data-gr-c-s-loaded="true">
   <h1>Crime Incidents in Seattle</h1>
   <h2>Hover over plot points for incident description.</h2>
   <div class="container"></div>


   <div class="container2">
        <h1>Count of burglaries by month</h1>
   </div>
</body>
<style>

    body {
        font-family: "Proxima Nova", "Montserrat", sans-serif;
        padding-left:50px;
    }
    h1, h2 {
        left: 10px;
        font-size: 1.3em;
        font-weight: 100;
    }
    h2 {
        top: 30px;
        font-size: 1em;
    }
    svg{
        text-align: center;
        margin: 0 auto;
    }
    .hover {
        fill: yellow;   
        r:15;
    }    
    .container{
        margin-top:40px;
    }
    .container2>h3{
        margin-bottom: 0px;
        margin-top:50px;
    }
    circle:hover{
        cursor: pointer;
        fill:red;
        r:10;
    }
    #sliderContainer{
        top: 300px;
        left: 50%;
        text-align: center;
        position: absolute;
    }
    .axis {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }    
</style>
 <script>
    var width = 700;
    var height = 580;
    var centered;
    var inputValue = null;
    var year = [2017,2016,2015,2014,2013,2012,2011]; //Slider selections
    var svg = d3.select( ".container" ) //creates SVG
        .append( "svg" )
        .attr( "width", width )
        .attr( "height", height );

    var g = svg.append( "g" );

    var albersProjection = d3.geo.albers()  //create albers projection
        .scale( 190000 )  
        .rotate( [122.3221,0] )   //rotate the projection to 
        .center( [0, 47.6062] )   //point to Seattle
        .translate( [width/2,height/2] );
       

    var geoPath = d3.geo.path()
        .projection(albersProjection );  //store this path as a variable.




    g.selectAll( "path" )                   
        .data(neighborhoods_json.features)  //grabs seattle neighborhood svg data. 
        .enter()
        .append( "path" )
        .attr( "fill", "none" )
        .attr( "stroke", "grey")
        .attr( "d", geoPath )

    
    var crimes = svg.append( "g" );
    crimes.selectAll( "path" )
        .data(crimedata.features)
        .enter()
        .append( "path" )
        .attr( "fill", initialDate )    //intial date checks which rows of data has year same as initially selected one. 
        .attr( "stroke", initialDate2 )  //same as above. 
        .attr( "d", geoPath )
        .attr( "class", "crime")
        .on("mouseover", function(d){   //hover function - displays brief description regarding the incident. 
            var description = d.properties["Offense Type"];
            var result ="A ";
            var arr = description.split("-"); //splits the description into arrays. 
            for(var i = 0; i < arr.length; i++){    //parse throught the words and create human readable sentences. 
                if(arr[i] == "FORCE"){
                    result += " forced burglary";
                } else if (arr[i] == "NOFORCE"){
                    result += " non-forced burglary";
                } else if(arr[i] == "SECURE PARKING"){
                    result += " burglary in a secure parking lot";
                } else if (arr[i] == "NONRES"){
                    result += " at a non-residential area close to " +d.properties["Hundred Block Location"]+ " on " +d.properties["Date Reported"] +".";
                }else if (arr[i] == "RES"){
                    result += " at a residential area close to " +d.properties["Hundred Block Location"]+ " on " +d.properties["Date Reported"] +".";
                }     
            }
            d3.select("h2").text(result); //displays the constructed human-readble sntence in h2.
            d3.select(this).attr("class","crime hover"); 
        })
        .on("click", function(d){
             var x, y, k;
            if (d && centered !== d) {
                var centroid = geoPath.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }
            g.selectAll("path")
                .classed("active", centered && function(d) { return d === centered; });
            g.transition()
                .duration(750)
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                .style("stroke-width", 1.5 / k + "px");
        })
        .on("mouseout", function(d){  //h2 reverts back to default text on hover-out. 
            d3.select("h2").text("Hover over plot points for incident description.");
            d3.select(this).attr("class","crime");
        }); 
         
    d3.select("#timeslide").on("input", function() {  //updates the value per each slide. 
        update(+this.value);
    });


    //plays animation.
    var myTimer;
    d3.select("#start").on("click", function() {
        clearInterval (myTimer);
        myTimer = setInterval (function() {
            var b= d3.select("#timeslide");
            var t = (+b.property("value") + 1) % (+b.property("max") + 1);
            if (t == 0) { t = +b.property("min"); 
        }
        b.property("value", t);
        update (t);
        }, 2000);
    });
    d3.select("#stop").on("click", function() {
        clearInterval (myTimer);
    });


    // update the fill of each SVG of class "incident" with value
    function update(value) {
        document.getElementById("range").innerHTML=year[value]; //gets the slider value. 
        inputValue = year[value];
        d3.selectAll(".crime")
            .attr("fill", dateMatch)  //update the colors of the fills and strokes by comparing with years.
            .attr("stroke", dateMatch2);
    }

    function dateMatch(data, value) { //function that cheks whether the currect selected year matches the current row of data. if yes, 
                                        // changes color to red, if no, make plot point transparent. 
        var d = new Date(data.properties["Date Reported"]);
        var y = d.getYear()+1900;
        if (inputValue == y) {
            this.parentElement.appendChild(this);
            return "red"; 
        } else {
            return "none"; //fill color of the non-selected dots. 
        };
    }
    function initialDate(d,i){ // same as dateMatch function. 
        var d = new Date(d.properties["Date Reported"]);
        var y = d.getYear()+1900;
        
        if (y == 2017) {
            this.parentElement.appendChild(this);
            return "red";
        } else {
            return "none";//fill color of the non-selected dots. 
        };
    }

    function dateMatch2(data, value) { // same as dateMatch function. 
        var d = new Date(data.properties["Date Reported"]);
        var y = d.getYear()+1900;
        if (inputValue == y) {
            this.parentElement.appendChild(this);
            return "#999";
        } else {
            return "none"; //fill color of the non-selected dots. 
        };
    }
    function initialDate2(d,i){   // same as dateMatch function. 
        var d = new Date(d.properties["Date Reported"]);
        var y = d.getYear()+1900;
        
        if (y == 2017) {
            this.parentElement.appendChild(this);
            return "#999";
        } else {
            return "none";//fill color of the non-selected dots. 
        };
    }



    </script>
    

    <!--script for second visualization-->
    <script>
    var countsByMonth = [0,0,0,0,0,0,0,0,0,0,0,0]; //create an empty array with size 12 to count the occurences of crime per each month. 
    for(var i = 0; i < crimedata.features.length; i++){
        countsByMonth[new Date(crimedata.features[i].properties["Date Reported"]).getMonth()]++;  //incremets the array. 
    }
    var countX = 0;  //counter. 
    createVisualization2();

    var tooltip = d3.select("body")
        .append("div")
        .style("position", "absolute")
        .style("font-family", "sans-serif")
        .style("font-size", "10px")
        .style("z-index", "10")
        .style("visibility", "hidden");    
    function createVisualization2(){

			var w = 360;
			var h = 360;
            var padding = 40;

            var xScale = d3.scale.linear()
                .domain([0, 12])
                .range([padding, w-padding]);

            var yScale = d3.scale.linear()
                .domain([0, d3.max(countsByMonth, function(d) {
                    return d;
                })])
                .range([h-padding, padding]);

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h)
						.attr("style", "outline: none;");
                        
            var xAxis = d3.svg.axis()  //creates X Axis
                .scale(xScale)
                .orient("bottom")
                .ticks(11);
            var yAxis = d3.svg.axis()  //creates Y Axis
                .scale(yScale)
                .orient("left")
                .ticks(10);                
            
            

            svg.append("g")
                .attr("class", "axis")  //Assign "axis" class
			    .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ", 0)")
                .call(yAxis);                
            
            var value= ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            countX = 0;
            var myMap = new Map();  //create a map to get Month fvalue. 

			svg.selectAll("circle")
			   .data(countsByMonth)
			   .enter()
			   .append("circle")
			   .attr("cx", function(d) {
                   myMap.set(d, countX);
                   countX++;
			   	    return xScale(countX);
			   })
			   .attr("cy", function(d) {

			   		return yScale(d);
			   })
			   .attr("r", 8)
               .on("mouseover", function(d){
                    return tooltip.style("visibility", "visible").text(value[myMap.get(d)] +": "+d);    //displays the month and count of crimes on hover. 
                })
                .on("mousemove", function(d){
                    return tooltip.style("top", (event.pageY-20)+"px").style("left",(event.pageX+10)+"px").text(value[myMap.get(d)] +": "+d); //displays the month and conut of crimes on hover. 
                })
                .on("mouseout", function(d){
                    return tooltip.style("visibility", "hidden");
                });
    }

                               
    </script>
